<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Simple E‑Commerce</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
      h1 { margin-bottom: 0.25rem; }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
      .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; }
      .cart { margin-top: 2rem; }
      button { cursor: pointer; }
      .muted { color: #666; font-size: .9rem; }
    </style>
  </head>
  <body>
    <h1>Simple E‑Commerce</h1>
    <p class="muted">Products are static; cart is in-memory on the server.</p>

    <h2>Products</h2>
    <div id="products" class="grid"></div>

    <div class="cart">
      <h2>Cart</h2>
      <pre id="cart"></pre>
      <button id="clearCart">Clear Cart</button>
    </div>

    <script>
      async function fetchJSON(url, opts) {
        const res = await fetch(url, { headers: { 'Content-Type': 'application/json' }, ...opts });
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      }

      async function loadProducts() {
        const products = await fetchJSON('/products');
        const container = document.getElementById('products');
        container.innerHTML = '';
        products.forEach(p => {
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `
            <strong>${p.name}</strong><br/>
            Price: $${p.price}<br/><br/>
            <button data-id="${p.id}">Add to cart</button>
          `;
          div.querySelector('button').addEventListener('click', async () => {
            await fetchJSON('/cart/add', {
              method: 'POST',
              body: JSON.stringify({ productId: String(p.id), qty: 1 })
            });
            loadCart();
          });
          container.appendChild(div);
        });
      }

      async function loadCart() {
        const c = await fetchJSON('/cart');
        document.getElementById('cart').textContent = JSON.stringify(c, null, 2);
      }

      document.getElementById('clearCart').addEventListener('click', async () => {
        await fetchJSON('/cart/clear', { method: 'POST' });
        loadCart();
      });

      (async function init() {
        await loadProducts();
        await loadCart();
      })();
    </script>
  </body>
</html>
